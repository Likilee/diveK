{
  "project": "K-Context",
  "branchName": "ralph/k-context-search-engine-mvp",
  "description": "Build a K-culture subtitle search engine that maps partial meme/dialog queries to exact YouTube timeline playback with low-cost infrastructure.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Create video_chunks schema and search indexes",
      "description": "As a developer, I want a Supabase schema for chunked subtitles so that search data can be stored and queried efficiently.",
      "acceptanceCriteria": [
        "Create `video_chunks` table with `id`, `video_id`, `start_time`, `end_time`, `keywords`, and `full_text` columns",
        "Enable `pg_trgm` and add a trigram index for text search on `full_text`",
        "Add GIN index on `keywords` for array overlap/contains queries",
        "Migration applies successfully on a clean database",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement raw transcript fetch command",
      "description": "As a data operator, I want a CLI command to fetch raw YouTube transcript segments so that ingestion can start from normalized subtitle data.",
      "acceptanceCriteria": [
        "Add a CLI command that fetches transcript segments for a given video ID",
        "Normalize each segment to `{ offset, duration, text }` and skip empty text rows",
        "Return a clear error and non-zero exit code when captions are unavailable",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Build 15-second sliding-window chunker",
      "description": "As a data operator, I want transcript segments chunked with overlap so that user queries can match full conversational context.",
      "acceptanceCriteria": [
        "Transform raw segments into 15-second chunks with 5-second overlap",
        "Each chunk includes `start_time`, `end_time`, and concatenated `full_text`",
        "Unit tests cover boundary behavior and final partial-window handling",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Add keyword extraction and stopword filtering",
      "description": "As a data operator, I want Korean keyword extraction from each chunk so that morphology-aware searching can match varied query forms.",
      "acceptanceCriteria": [
        "Implement keyword extraction that outputs normalized noun/verb keyword arrays from chunk text",
        "Apply configurable Korean stopword removal before persisting keywords",
        "Unit tests validate stopword filtering and deterministic output shape",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement batch ingestion with checkpoint resume",
      "description": "As a data operator, I want end-to-end batch ingestion with resume support so that large channel imports are reliable and cost-efficient.",
      "acceptanceCriteria": [
        "Create pipeline command that runs fetch -> chunk -> keyword extraction -> Supabase batch insert",
        "Batch size is configurable and retry/backoff is applied for transient insert failures",
        "Persist local checkpoint state and resume from last successful item on rerun",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create search API with overlap-based ranking",
      "description": "As a user, I want partial phrase searches to return relevant clips so that I can find the original source quickly.",
      "acceptanceCriteria": [
        "Add search endpoint that accepts user query text and returns matching video chunks",
        "Ranking combines keyword overlap on `keywords` with trigram similarity on `full_text`",
        "Response includes `video_id`, `start_time`, and snippet text for UI rendering",
        "Tests pass",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Build search results UI with highlighted snippets",
      "description": "As a user, I want to search by remembered words and see highlighted matching lines so that I can recognize the correct clip before opening it.",
      "acceptanceCriteria": [
        "Search page includes query input and renders a result card list from the search API",
        "Each result card shows a snippet with matched terms rendered in bold or marked styling",
        "Selecting a result performs client-side navigation to the player route with video and time params",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Add mobile-optimized player view with unmute control",
      "description": "As a user, I want playback to start at the matched timestamp immediately on mobile so that I can confirm context with minimal taps.",
      "acceptanceCriteria": [
        "Player route initializes YouTube iframe with `autoplay=1`, `mute=1`, and the requested start time",
        "Display a clear on-screen unmute control that enables sound on user interaction",
        "Navigation from search to player occurs without full page reload or visible flicker",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Track SPA virtual pageviews and refresh ad slots",
      "description": "As an operator, I want route-level analytics and ad refresh on SPA transitions so that funnel analysis and ad monetization stay accurate.",
      "acceptanceCriteria": [
        "Route observer using `usePathname` and `useSearchParams` emits GA4 virtual pageview on every route change",
        "Back/forward navigation also emits virtual pageview with the updated path/query",
        "AdSense slot remount or refresh logic runs once when entering each virtual page",
        "Verify in browser using dev-browser skill",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    }
  ]
}
